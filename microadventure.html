<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicroAdventure - Gioco di Microbiologia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .level-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .level-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .level-card:hover::before {
            left: 100%;
        }

        .level-card:hover {
            transform: translateY(-10px);
            border-color: #4ecdc4;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .level-card h3 {
            color: #2c3e50;
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .level-card .emoji {
            font-size: 2rem;
            margin-right: 10px;
        }

        .level-card p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .level-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .topic-tag {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .game-area {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .question-area {
            margin-bottom: 30px;
        }

        .question {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #4ecdc4;
        }

        .answers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .answer-btn {
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .answer-btn:hover {
            border-color: #4ecdc4;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .answer-btn.correct {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            border-color: #27ae60;
        }

        .answer-btn.incorrect {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border-color: #c0392b;
        }

        .score-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
        }

        .back-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .completion-message {
            text-align: center;
            padding: 30px;
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            border-radius: 15px;
            margin-top: 20px;
            display: none;
        }

        .powerups-area {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .powerup {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }

        .powerup:hover:not(.disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .powerup.disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .powerup.used {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        .powerup::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .powerup:hover:not(.disabled)::before {
            left: 100%;
        }

        .powerup-count {
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-left: 5px;
        }

        .powerup-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 1001;
            animation: powerupNotification 2s ease-out forwards;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        @keyframes powerupNotification {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
        }

        .answer-btn.eliminated {
            background: #bdc3c7;
            color: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.5;
            text-decoration: line-through;
        }

        .time-bonus-active {
            animation: timeBonusPulse 1s infinite;
        }

        @keyframes timeBonusPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(52, 152, 219, 0.5); }
            50% { box-shadow: 0 0 30px rgba(52, 152, 219, 0.8); }
        }

        /* Stili per il cruciverba */
        .crossword-container {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        .crossword-grid {
            display: grid;
            grid-template-columns: repeat(16, 35px);
            grid-template-rows: repeat(16, 35px);
            gap: 2px;
            justify-content: center;
            margin: 20px 0;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }

        .crossword-cell {
            width: 35px;
            height: 35px;
            border: 2px solid #ddd;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .crossword-cell.blocked {
            background: #2c3e50;
            border-color: #2c3e50;
            cursor: default;
        }

        .crossword-cell.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }

        .crossword-cell.correct {
            background: #2ecc71;
            color: white;
            border-color: #27ae60;
        }

        .crossword-cell.word-highlight {
            background: #f39c12;
            border-color: #e67e22;
        }

        .crossword-cell input {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            color: inherit;
            text-transform: uppercase;
        }

        .crossword-cell input:focus {
            outline: none;
        }

        .cell-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 12px;
            color: #2c3e50;
            font-weight: bold;
        }

        .crossword-clues {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .clues-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .clue {
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clue:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .clue.active {
            background: #3498db;
            color: white;
        }

        .clue.completed {
            background: #2ecc71;
            color: white;
        }

        .crossword-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
        }

        .crossword-complete {
            text-align: center;
            padding: 30px;
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            border-radius: 15px;
            margin-top: 20px;
            display: none;
        }

        .particle {
            position: fixed;
            pointer-events: none;
            font-size: 20px;
            z-index: 1000;
            animation: particleFloat 2s ease-out forwards;
        }

        @keyframes particleFloat {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .level-card {
                padding: 20px;
            }
            
            .answers {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>ü¶† MicroAdventure üß¨</h1>
            <p>Esplora il mondo della microbiologia attraverso un'avventura interattiva!</p>
        </div>

        <div id="levelSelector" class="level-selector">
            <div class="level-card" onclick="startLevel(1)">
                <h3><span class="emoji">ü¶†</span>Livello 1: Il Regno dei Microrganismi</h3>
                <p>Scopri il ruolo dei microrganismi negli alimenti e impara a distinguere tra patogeni, non patogeni e microrganismi benefici.</p>
                <div class="level-topics">
                    <span class="topic-tag">Ruolo dei microrganismi</span>
                    <span class="topic-tag">Carta microbiologica</span>
                    <span class="topic-tag">Crescita microbica</span>
                </div>
            </div>

            <div class="level-card" onclick="startLevel(2)">
                <h3><span class="emoji">üåç</span>Livello 2: Origine e Colonizzazione</h3>
                <p>Esplora come i microrganismi colonizzano gli alimenti e comprendi le diverse fonti di contaminazione.</p>
                <div class="level-topics">
                    <span class="topic-tag">Flora microbica</span>
                    <span class="topic-tag">Origine endogena/esogena</span>
                    <span class="topic-tag">Ecosistemi alimentari</span>
                </div>
            </div>

            <div class="level-card" onclick="startLevel(3)">
                <h3><span class="emoji">‚ö†Ô∏è</span>Livello 3: Contaminazione Alimentare</h3>
                <p>Impara i diversi tipi di contaminazione e le loro cause, dalla contaminazione primaria a quella crociata.</p>
                <div class="level-topics">
                    <span class="topic-tag">Rischi chimici/fisici/biologici</span>
                    <span class="topic-tag">Contaminazione primaria/secondaria</span>
                    <span class="topic-tag">Contaminazione crociata</span>
                </div>
            </div>

            <div class="level-card" onclick="startLevel(4)">
                <h3><span class="emoji">üî¨</span>Livello 4: Microrganismi Indicatori</h3>
                <p>Scopri i microrganismi indicatori di salubrit√†, qualit√† e tipicit√† negli alimenti e il loro ruolo nel controllo microbiologico.</p>
                <div class="level-topics">
                    <span class="topic-tag">Indicatori di salubrit√†</span>
                    <span class="topic-tag">Indicatori di qualit√†</span>
                    <span class="topic-tag">Indicatori protecnologici</span>
                </div>
            </div>

            <div class="level-card" onclick="startCrossword()">
                <h3><span class="emoji">üß©</span>Bonus: Cruciverba Microbiologico</h3>
                <p>Metti alla prova la tua conoscenza con un cruciverba interattivo basato sui concetti appresi.</p>
                <div class="level-topics">
                    <span class="topic-tag">Terminologia</span>
                    <span class="topic-tag">Concetti chiave</span>
                    <span class="topic-tag">Ripasso generale</span>
                </div>
            </div>
        </div>

        <div id="gameArea" class="game-area">
            <button class="back-btn" onclick="backToMenu()">‚Üê Torna al Menu</button>
            
            <div class="score-area">
                <div>
                    <strong>Livello: <span id="currentLevel">1</span></strong>
                </div>
                <div>
                    <strong>Punteggio: <span id="score">0</span></strong>
                </div>
                <div>
                    <strong>Domanda: <span id="questionNumber">1</span>/<span id="totalQuestions">10</span></strong>
                </div>
            </div>

            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>

            <div class="powerups-area">
                <button id="fiftyFifty" class="powerup" onclick="usePowerup('fiftyFifty')">
                    üéØ 50/50 <span class="powerup-count" id="fiftyFiftyCount">2</span>
                </button>
                <button id="skipQuestion" class="powerup" onclick="usePowerup('skipQuestion')">
                    ‚è≠Ô∏è Skip <span class="powerup-count" id="skipQuestionCount">1</span>
                </button>
                <button id="timeBonus" class="powerup" onclick="usePowerup('timeBonus')">
                    ‚ö° Bonus <span class="powerup-count" id="timeBonusCount">2</span>
                </button>
                <button id="doublePoints" class="powerup" onclick="usePowerup('doublePoints')">
                    üíé x2 <span class="powerup-count" id="doublePointsCount">1</span>
                </button>
            </div>

            <div class="question-area">
                <div id="question" class="question"></div>
                <div id="answers" class="answers"></div>
            </div>

            <div id="completionMessage" class="completion-message">
                <h3>üéâ Livello Completato! üéâ</h3>
                <p>Hai completato con successo questo livello!</p>
                <p>Punteggio finale: <span id="finalScore"></span></p>
            </div>
        </div>

        <div id="crosswordArea" class="crossword-container">
            <button class="back-btn" onclick="backToMenu()">‚Üê Torna al Menu</button>
            
            <div class="crossword-stats">
                <div><strong>Cruciverba Microbiologico</strong></div>
                <div><strong>Completate: <span id="crosswordProgress">0</span>/19</strong></div>
                <div><strong>Tempo: <span id="crosswordTime">00:00</span></strong></div>
            </div>

            <div class="crossword-grid" id="crosswordGrid"></div>

            <div class="crossword-clues">
                <div class="clues-section">
                    <h4>Orizzontali</h4>
                    <div id="horizontalClues"></div>
                </div>
                <div class="clues-section">
                    <h4>Verticali</h4>
                    <div id="verticalClues"></div>
                </div>
            </div>

            <div id="crosswordComplete" class="crossword-complete">
                <h3>üéâ Cruciverba Completato! üéâ</h3>
                <p>Hai dimostrato una conoscenza eccellente della microbiologia!</p>
                <p>Tempo finale: <span id="finalTime"></span></p>
            </div>
        </div>
    </div>

    <script>
        // Database delle domande per i livelli
        const questions = {
            1: [ // Livello 1: Il Regno dei Microrganismi
                {
                    question: "Quali sono i tre tipi di microrganismi che hanno il maggiore impatto sugli alimenti?",
                    answers: [
                        "Virus, alghe e protozoi",
                        "Batteri, lieviti e muffe",
                        "Solo batteri",
                        "Alghe, protozoi e virus"
                    ],
                    correct: 1
                },
                {
                    question: "Quale tra queste NON √® una capacit√† fondamentale dei microrganismi negli alimenti?",
                    answers: [
                        "Trasformare la materia prima",
                        "Rispondere agli stimoli",
                        "Moltiplicarsi",
                        "Cambiare colore"
                    ],
                    correct: 3
                },
                {
                    question: "Come si chiamano i microrganismi che causano malattie al consumatore?",
                    answers: [
                        "Alteranti",
                        "Patogeni",
                        "Indigeni",
                        "Inerti"
                    ],
                    correct: 1
                },
                {
                    question: "Quale batterio lattico √® citato come esempio di microrganismo positivo?",
                    answers: [
                        "Escherichia coli",
                        "Salmonella spp.",
                        "Lactobacillus helveticus",
                        "Staphylococcus aureus"
                    ],
                    correct: 2
                },
                {
                    question: "Come si riproducono principalmente i batteri?",
                    answers: [
                        "Per gemmazione",
                        "Per accrescimento apicale",
                        "Per scissione binaria",
                        "Per spore"
                    ],
                    correct: 2
                },
                {
                    question: "Quale fase della crescita microbica √® caratterizzata dall'adattamento al substrato?",
                    answers: [
                        "Fase esponenziale",
                        "Fase stazionaria",
                        "Fase di latenza",
                        "Fase di morte"
                    ],
                    correct: 2
                },
                {
                    question: "Durante quale fase i microrganismi crescono alla massima velocit√†?",
                    answers: [
                        "Fase lag",
                        "Fase logaritmica",
                        "Fase stazionaria",
                        "Fase di morte"
                    ],
                    correct: 1
                },
                {
                    question: "Cosa caratterizza la fase stazionaria della crescita microbica?",
                    answers: [
                        "Crescita massima",
                        "Adattamento al substrato",
                        "Equilibrio tra crescita e morte",
                        "Diminuzione delle cellule"
                    ],
                    correct: 2
                },
                {
                    question: "Quale microrganismo √® citato come esempio di produttore di tossine?",
                    answers: [
                        "Lactobacillus bulgaricus",
                        "Saccharomyces cerevisiae",
                        "Staphylococcus aureus",
                        "Penicillium roqueforti"
                    ],
                    correct: 2
                },
                {
                    question: "Come si riproducono principalmente i lieviti?",
                    answers: [
                        "Per scissione binaria",
                        "Per gemmazione",
                        "Per accrescimento apicale",
                        "Per frammentazione"
                    ],
                    correct: 1
                }
            ],
            2: [ // Livello 2: Origine e Colonizzazione
                {
                    question: "Cosa si intende per microrganismi di origine endogena?",
                    answers: [
                        "Microrganismi dall'ambiente esterno",
                        "Microrganismi che provengono dall'organismo da cui √® prodotto l'alimento",
                        "Microrganismi aggiunti intenzionalmente",
                        "Microrganismi dall'aria"
                    ],
                    correct: 1
                },
                {
                    question: "Quali sono le principali fonti di microrganismi di origine esogena?",
                    answers: [
                        "Solo l'acqua",
                        "Solo il suolo",
                        "Suolo, acqua, aria e flora cutanea",
                        "Solo la flora cutanea"
                    ],
                    correct: 2
                },
                {
                    question: "Quale habitat √® dominato prevalentemente da lieviti e muffe?",
                    answers: [
                        "Epidermide dei mammiferi",
                        "Pelle dei pesci",
                        "Frutti",
                        "Latte bovino"
                    ],
                    correct: 2
                },
                {
                    question: "Cosa rappresenta l'HABITAT in un ecosistema alimentare?",
                    answers: [
                        "La comunit√† biologica",
                        "Le caratteristiche abiotiche dell'ambiente",
                        "I gruppi di individui della stessa specie",
                        "L'insieme delle popolazioni"
                    ],
                    correct: 1
                },
                {
                    question: "Cosa si intende per NICCHIA in microbiologia alimentare?",
                    answers: [
                        "Le caratteristiche fisiche dell'ambiente",
                        "Comunit√† biologica con attivit√† metabolica specifica",
                        "Gruppi della stessa specie",
                        "Insieme di tutte le popolazioni"
                    ],
                    correct: 1
                },
                {
                    question: "Quali batteri dominano nella carne fresca refrigerata?",
                    answers: [
                        "Batteri Gram positivi",
                        "Batteri Gram negativi psicrotrofi",
                        "Solo lattobacilli",
                        "Solo stafilococchi"
                    ],
                    correct: 1
                },
                {
                    question: "Cosa succede alla microflora quando la carne viene trattata con sale?",
                    answers: [
                        "Rimane invariata",
                        "Si sposta verso batteri Gram negativi",
                        "Si sposta verso batteri Gram positivi",
                        "Scompare completamente"
                    ],
                    correct: 2
                },
                {
                    question: "Gli alimenti sono ecosistemi:",
                    answers: [
                        "Statici e omogenei",
                        "Statici e eterogenei",
                        "Dinamici e omogenei",
                        "Dinamici e eterogenei"
                    ],
                    correct: 3
                },
                {
                    question: "Quale genere batterico √® tipico dell'epidermide dei mammiferi?",
                    answers: [
                        "Pseudomonas",
                        "Lactobacillus",
                        "Staphylococcus",
                        "Clostridium"
                    ],
                    correct: 2
                },
                {
                    question: "Da cosa dipende principalmente la colonizzazione di un alimento?",
                    answers: [
                        "Solo dalla temperatura",
                        "Solo dal pH",
                        "Dall'ecologia e sviluppo delle comunit√† microbiche",
                        "Solo dall'umidit√†"
                    ],
                    correct: 2
                }
            ],
            3: [ // Livello 3: Contaminazione Alimentare
                {
                    question: "Quanti casi di gastroenterite vengono segnalati annualmente nel mondo?",
                    answers: [
                        "Circa 1 miliardo",
                        "Circa 3 miliardi",
                        "Oltre 5 miliardi",
                        "Circa 2 miliardi"
                    ],
                    correct: 2
                },
                {
                    question: "Quale soglia di cellule microbiche indica un alimento CONTAMINATO?",
                    answers: [
                        "> 10¬≤ UFC/g",
                        "> 10¬≥ UFC/g", 
                        "> 10‚Å¥ UFC/g",
                        "> 10‚Åµ UFC/g"
                    ],
                    correct: 2
                },
                {
                    question: "Quale tipo di contaminazione √® pi√π rilevante per la ristorazione?",
                    answers: [
                        "Rischio chimico",
                        "Rischio fisico",
                        "Rischio biologico",
                        "Tutti ugualmente"
                    ],
                    correct: 2
                },
                {
                    question: "Quando si verifica la contaminazione primaria?",
                    answers: [
                        "Durante la lavorazione",
                        "Durante la conservazione",
                        "In fase di produzione delle materie prime",
                        "Durante il trasporto"
                    ],
                    correct: 2
                },
                {
                    question: "La contaminazione secondaria √® principalmente causata da:",
                    answers: [
                        "Acqua, suolo e aria",
                        "Personale e attrezzature",
                        "Animali ammalati",
                        "Materie prime contaminate"
                    ],
                    correct: 1
                },
                {
                    question: "Cosa si intende per contaminazione crociata?",
                    answers: [
                        "Contaminazione da animali",
                        "Contaminazione chimica",
                        "Trasferimento di microrganismi tra alimenti",
                        "Contaminazione da superfici"
                    ],
                    correct: 2
                },
                {
                    question: "Quale caratteristica hanno i batteri dei generi Clostridium e Bacillus?",
                    answers: [
                        "Non sopravvivono al calore",
                        "Formano spore in condizioni avverse",
                        "Crescono solo in aerobiosi",
                        "Non sono patogeni"
                    ],
                    correct: 1
                },
                {
                    question: "Il rischio fisico √® determinato da:",
                    answers: [
                        "Microrganismi patogeni",
                        "Sostanze chimiche tossiche",
                        "Pezzi di macchinari, vetro, metalli",
                        "Spore batteriche"
                    ],
                    correct: 2
                },
                {
                    question: "Le vie dirette di contaminazione dell'uomo includono:",
                    answers: [
                        "Solo le mani",
                        "Pelle e saliva",
                        "Solo attrezzature",
                        "Solo vestiario"
                    ],
                    correct: 1
                },
                {
                    question: "L'aumento del rischio microbiologico √® dovuto principalmente a:",
                    answers: [
                        "Cambiamento delle abitudini alimentari",
                        "Peggioramento dell'igiene",
                        "Aumento dei patogeni",
                        "Cambiamenti climatici"
                    ],
                    correct: 0
                },
                {
                    question: "Cosa succede ai batteri sporigeni quando le condizioni ambientali migliorano?",
                    answers: [
                        "Muoiono definitivamente",
                        "Ritornano alla forma vegetativa e ricominciano a riprodursi",
                        "Rimangono sempre in forma di spore",
                        "Si trasformano in virus"
                    ],
                    correct: 1
                },
                {
                    question: "Quali microrganismi sono favoriti dalle operazioni di refrigerazione?",
                    answers: [
                        "Microrganismi termofili",
                        "Microrganismi psicrotrofi come Pseudomonas",
                        "Solo batteri sporigeni",
                        "Microrganismi mesofili"
                    ],
                    correct: 1
                },
                {
                    question: "A quale temperatura si eliminano completamente le spore batteriche?",
                    answers: [
                        "65-80¬∞C",
                        "100¬∞C",
                        "110¬∞C",
                        "121¬∞C per 15-20 minuti"
                    ],
                    correct: 3
                },
                {
                    question: "Quali microrganismi sono favoriti dalle operazioni sottovuoto?",
                    answers: [
                        "Microrganismi aerobi obbligati",
                        "Microrganismi anaerobi obbligati e facoltativi",
                        "Solo muffe",
                        "Solo lieviti"
                    ],
                    correct: 1
                },
                {
                    question: "Quali microrganismi sono favoriti dall'essiccamento degli alimenti?",
                    answers: [
                        "Batteri",
                        "Virus",
                        "Muffe, che sono poco esigenti per quanto riguarda l'aw",
                        "Protozoi"
                    ],
                    correct: 2
                },
                {
                    question: "Quali sono i principali microrganismi Gram-negativi veicolati da acqua e terreno?",
                    answers: [
                        "Lactobacillus e Streptococcus",
                        "Aeromonas, Escherichia, Pseudomonas, Vibrio, Yersinia",
                        "Solo Staphylococcus",
                        "Solo Clostridium"
                    ],
                    correct: 1
                },
                {
                    question: "Cosa veicolano principalmente aria e polvere?",
                    answers: [
                        "Solo batteri vegetativi",
                        "Microrganismi sporigeni, micrococchi e spore di muffe",
                        "Solo virus",
                        "Solo protozoi"
                    ],
                    correct: 1
                },
                {
                    question: "Quale parte dell'animale rappresenta una fonte importante di batteri patogeni?",
                    answers: [
                        "Solo la pelle",
                        "Solo i muscoli",
                        "Il tratto gastro-intestinale",
                        "Solo le ossa"
                    ],
                    correct: 2
                },
                {
                    question: "Cosa determina la dominanza di specifici microrganismi durante le operazioni tecnologiche?",
                    answers: [
                        "Solo la temperatura",
                        "La variazione delle condizioni fisico-chimiche (aw, pH, temperatura, areazione)",
                        "Solo il pH",
                        "Solo l'umidit√†"
                    ],
                    correct: 1
                },
                {
                    question: "Quando aumenta maggiormente il rischio di contaminazione negli alimenti?",
                    answers: [
                        "Durante la conservazione in frigorifero",
                        "Ad ogni manipolazione",
                        "Solo durante la cottura",
                        "Solo durante il confezionamento"
                    ],
                    correct: 1
                }
            ],
            4: [ // Livello 4: Microrganismi Indicatori
                {
                    question: "Qual √® la differenza principale tra marker, indici e indicatori?",
                    answers: [
                        "Sono tutti sinonimi",
                        "I marker indicano pericolo, gli indici riassumono presenza di patogeni, gli indicatori mostrano qualit√† generale",
                        "Solo i marker sono importanti",
                        "Gli indicatori sono sempre patogeni"
                    ],
                    correct: 1
                },
                {
                    question: "Quali sono le tre categorie principali di microrganismi indicatori?",
                    answers: [
                        "Batteri, lieviti, muffe",
                        "Aerobi, anaerobi, facoltativi",
                        "Indicatori di salubrit√†, di qualit√†, di tipicit√†",
                        "Gram-positivi, Gram-negativi, sporigeni"
                    ],
                    correct: 2
                },
                {
                    question: "Cosa rappresenta la microflora aerobia totale?",
                    answers: [
                        "Solo i batteri patogeni",
                        "La popolazione batterica in grado di svilupparsi in aerobiosi e mesofilia",
                        "Solo i lieviti",
                        "Solo le muffe"
                    ],
                    correct: 1
                },
                {
                    question: "Quale caratteristica devono avere i microrganismi indicatori di salubrit√†?",
                    answers: [
                        "Essere sempre patogeni",
                        "Essere facilmente rilevabili e correlati con i patogeni di interesse",
                        "Crescere solo ad alte temperature",
                        "Essere presenti solo negli alimenti alterati"
                    ],
                    correct: 1
                },
                {
                    question: "Cosa sono i coliformi?",
                    answers: [
                        "Batteri Gram-positivi sporigeni",
                        "Batteri Gram-negativi, non sporigeni, anaerobi facoltativi, che fermentano il lattosio",
                        "Solo lieviti",
                        "Virus enterici"
                    ],
                    correct: 1
                },
                {
                    question: "Qual √® la temperatura caratteristica per i coliformi fecali?",
                    answers: [
                        "30¬∞C",
                        "37¬∞C",
                        "44,5¬∞C",
                        "50¬∞C"
                    ],
                    correct: 2
                },
                {
                    question: "Cosa indica la presenza di E. coli in alimenti trattati al calore?",
                    answers: [
                        "Normale presenza",
                        "Contaminazione post-processo",
                        "Buona qualit√† del prodotto",
                        "Processo di fermentazione attivo"
                    ],
                    correct: 1
                },
                {
                    question: "Quali sono le caratteristiche dei clostridi solfito-riduttori?",
                    answers: [
                        "Gram-negativi, aerobi, non sporigeni",
                        "Gram-positivi, sporigeni, anaerobi, riducono i solfiti",
                        "Solo lieviti",
                        "Virus resistenti"
                    ],
                    correct: 1
                },
                {
                    question: "Quando diventano predominanti lieviti e muffe negli alimenti?",
                    answers: [
                        "Sempre",
                        "Mai",
                        "Quando le condizioni per la crescita batterica diventano meno favorevoli",
                        "Solo durante la cottura"
                    ],
                    correct: 2
                },
                {
                    question: "Cosa sono le Enterobacteriaceae come indicatori?",
                    answers: [
                        "Indicatori di processo per rilevare anomalie nei trattamenti",
                        "Solo patogeni",
                        "Solo saprofiti",
                        "Indicatori di fermentazione"
                    ],
                    correct: 0
                },
                {
                    question: "Quali microrganismi sono considerati indicatori di tipicit√†?",
                    answers: [
                        "Solo patogeni",
                        "Microrganismi responsabili dei processi fermentativi come batteri lattici e lieviti",
                        "Solo contaminanti",
                        "Solo sporigeni"
                    ],
                    correct: 1
                },
                {
                    question: "Qual √® il pH minimo di crescita per i clostridi solfito-riduttori?",
                    answers: [
                        "pH 3",
                        "pH 4",
                        "pH 5",
                        "pH 7"
                    ],
                    correct: 2
                },
                {
                    question: "Cosa producono i batteri lattici durante la fermentazione?",
                    answers: [
                        "Solo gas",
                        "Acido lattico che riduce il pH e inibisce i patogeni",
                        "Solo alcol",
                        "Solo proteine"
                    ],
                    correct: 1
                },
                {
                    question: "Quale test √® caratteristico per identificare E. coli?",
                    answers: [
                        "Solo catalasi",
                        "Produzione di indolo, rosso-metile positivo, VP negativo",
                        "Solo fermentazione del lattosio",
                        "Solo crescita in aerobiosi"
                    ],
                    correct: 1
                },
                {
                    question: "Perch√© gli streptococchi fecali sono utili come indicatori?",
                    answers: [
                        "Sono sempre patogeni",
                        "Hanno notevole resistenza e indicano ricontaminazioni post-processo",
                        "Crescono solo ad alte temperature",
                        "Sono presenti solo nell'acqua"
                    ],
                    correct: 1
                },
                {
                    question: "Cosa indica un alto numero di microrganismi aerobi totali?",
                    answers: [
                        "Sempre sicurezza alimentare",
                        "Informazioni sulla storia produttiva e stato di conservazione",
                        "Presenza di vitamine",
                        "Assenza di contaminazione"
                    ],
                    correct: 1
                },
                {
                    question: "Quali sono le caratteristiche generali delle Enterobacteriaceae?",
                    answers: [
                        "Gram-positivi, sporigeni, aerobi",
                        "Gram-negativi, non sporigeni, anaerobi facoltativi, catalasi positivi",
                        "Solo lieviti",
                        "Solo anaerobi obbligati"
                    ],
                    correct: 1
                },
                {
                    question: "In quali prodotti lieviti e muffe diventano problematici?",
                    answers: [
                        "Solo nella carne",
                        "Prodotti caseari fermentati, bevande fermentate, pane, frutta",
                        "Solo nel pesce",
                        "Solo negli oli"
                    ],
                    correct: 1
                },
                {
                    question: "Cosa sono le muffe termoresistenti?",
                    answers: [
                        "Muffe che muoiono sempre al calore",
                        "Muffe che possono sopravvivere ai processi termici per frutta",
                        "Solo lieviti",
                        "Batteri sporigeni"
                    ],
                    correct: 1
                },
                {
                    question: "Qual √® lo scopo ultimo delle analisi microbiologiche alimentari?",
                    answers: [
                        "Aumentare i costi",
                        "Ottenere un prodotto conforme, sano e salubre per il consumatore",
                        "Ridurre la shelf-life",
                        "Aumentare la contaminazione"
                    ],
                    correct: 1
                }
            ]
        };

        let currentLevel = 1;
        let currentQuestion = 0;
        let score = 0;
        let levelQuestions = [];
        let powerups = {
            fiftyFifty: 2,
            skipQuestion: 1,
            timeBonus: 2,
            doublePoints: 1
        };
        let activePowerups = {
            timeBonus: false,
            doublePoints: false
        };
        let eliminatedAnswers = [];
        
        // Dati per il cruciverba
        const crosswordData = {
            grid: [
                ['', '', '', 'E', '', '', '', '', 'S', '', '', '', '', '', '', ''],
                ['E', '', '', 'N', '', 'P', 'A', 'T', 'O', 'G', 'E', 'N', 'I', '', '', ''],
                ['C', '', '', 'D', '', 'S', '', '', 'R', '', '', '', 'N', '', 'S', ''],
                ['O', 'S', 'A', 'L', 'U', 'B', 'R', 'I', 'T', 'A', '', '', 'D', '', 'C', ''],
                ['S', '', '', 'O', '', 'C', '', '', 'G', '', 'Q', '', 'I', '', 'I', ''],
                ['I', '', '', 'G', '', 'R', '', '', 'E', '', 'U', '', 'C', '', 'S', ''],
                ['S', 'M', 'U', 'F', 'F', 'E', '', '', 'N', '', 'A', '', 'A', 'T', 'S', ''],
                ['T', '', '', 'N', '', 'T', '', 'H', 'A', 'B', 'I', 'T', 'A', 'E', 'I', ''],
                ['E', 'L', 'I', 'E', 'V', 'I', 'T', 'I', '', '', 'T', '', 'T', 'R', 'O', ''],
                ['M', '', '', 'A', '', 'O', '', '', 'C', 'R', 'O', 'C', 'I', 'A', 'T', 'A'],
                ['A', '', '', '', '', 'F', '', '', '', '', '', '', 'O', 'M', 'N', ''],
                ['', '', '', '', '', 'I', 'M', 'A', 'R', 'K', 'E', 'R', 'R', 'O', 'E', ''],
                ['', '', 'C', 'O', 'L', 'I', 'F', 'O', 'R', 'M', 'I', '', 'I', 'F', '', ''],
                ['', '', '', '', '', '', 'T', 'I', 'P', 'I', 'C', 'I', 'T', 'A', '', ''],
                ['', '', 'L', 'A', 'T', 'T', 'I', 'C', 'I', '', '', '', '', 'I', '', ''],
                ['', '', '', '', '', '', '', '', 'A', 'E', 'R', 'O', 'B', 'I', 'A', '']
            ],
            words: [
                {
                    word: "PATOGENI",
                    clue: "Microrganismi che causano malattie al consumatore (Livello 1)",
                    row: 1,
                    col: 5,
                    direction: "horizontal",
                    number: 1
                },
                {
                    word: "PSICROTROFI",
                    clue: "Microrganismi favoriti dalle basse temperature (Livello 3)",
                    row: 1,
                    col: 5,
                    direction: "vertical",
                    number: 2
                },
                {
                    word: "INDICATORI",
                    clue: "Microrganismi che forniscono informazioni sulla qualit√† (Livello 4)",
                    row: 1,
                    col: 12,
                    direction: "vertical",
                    number: 3
                },

                {
                    word: "MUFFE",
                    clue: "Microrganismi che crescono per accrescimento apicale (Livello 1)",
                    row: 6,
                    col: 1,
                    direction: "horizontal",
                    number: 4
                },
                {
                    word: "LIEVITI",
                    clue: "Microrganismi che si riproducono per gemmazione (Livello 1)",
                    row: 8,
                    col: 1,
                    direction: "horizontal",
                    number: 5
                },
                {
                    word: "ENDOGENA",
                    clue: "Origine dei microrganismi dall'organismo stesso (Livello 2)",
                    row: 0,
                    col: 3,
                    direction: "vertical",
                    number: 6
                },
                {
                    word: "HABITAT",
                    clue: "Caratteristiche abiotiche dell'ambiente (Livello 2)",
                    row: 7,
                    col: 7,
                    direction: "horizontal",
                    number: 7
                },
                {
                    word: "SPORIGENI",
                    clue: "Batteri che formano spore in condizioni avverse (Livello 3)",
                    row: 0,
                    col: 8,
                    direction: "vertical",
                    number: 8
                },
                {
                    word: "CROCIATA",
                    clue: "Tipo di contaminazione tra alimenti diversi (Livello 3)",
                    row: 9,
                    col: 8,
                    direction: "horizontal",
                    number: 9
                },
                {
                    word: "QUALITA",
                    clue: "Categoria di indicatori per valutare condizioni di processo (Livello 4)",
                    row: 4,
                    col: 10,
                    direction: "vertical",
                    number: 10
                },
                {
                    word: "MARKER",
                    clue: "Organismi che indicano situazioni potenzialmente pericolose (Livello 4)",
                    row: 11,
                    col: 6,
                    direction: "horizontal",
                    number: 11
                },
                {
                    word: "SCISSIONE",
                    clue: "Tipo di riproduzione tipica dei batteri (Livello 1)",
                    row: 2,
                    col: 14,
                    direction: "vertical",
                    number: 12
                },
                {
                    word: "ECOSISTEMA",
                    clue: "Sistema complesso formato da ambiente e microrganismi (Livello 2)",
                    row: 1,
                    col: 0,
                    direction: "vertical",
                    number: 13
                },
                {
                    word: "TIPICITA",
                    clue: "Categoria di indicatori per processi fermentativi (Livello 4)",
                    row: 13,
                    col: 7,
                    direction: "horizontal",
                    number: 14
                },
                {
                    word: "SALUBRITA",
                    clue: "Categoria di indicatori per la sicurezza alimentare (Livello 4)",
                    row: 3,
                    col: 1,
                    direction: "horizontal",
                    number: 15
                },
                {
                    word: "LATTICI",
                    clue: "Batteri che producono acido lattico (Livello 4)",
                    row: 14,
                    col: 2,
                    direction: "horizontal",
                    number: 16
                },
                {
                    word: "TERMOFILI",
                    clue: "Microrganismi che crescono ad alte temperature (Livello 3)",
                    row: 6,
                    col: 13,
                    direction: "vertical",
                    number: 17
                },
                {
                    word: "AEROBIA",
                    clue: "Microflora che cresce in presenza di ossigeno (Livello 4)",
                    row: 15,
                    col: 9,
                    direction: "horizontal",
                    number: 18
                },
                {
                    word: "COLIFORMI",
                    clue: "Batteri indicatori di contaminazione fecale (Livello 4)",
                    row: 12,
                    col: 2,
                    direction: "horizontal",
                    number: 19
                }
            ]
        };
        
        let currentWord = null;
        let completedWords = new Set();
        let crosswordStartTime = null;

        function startLevel(level) {
            currentLevel = level;
            currentQuestion = 0;
            score = 0;
            levelQuestions = [...questions[level]]; // Copia le domande
            
            // Reset powerups per ogni livello
            powerups = {
                fiftyFifty: 2,
                skipQuestion: 1,
                timeBonus: 2,
                doublePoints: 1
            };
            activePowerups = {
                timeBonus: false,
                doublePoints: false
            };
            eliminatedAnswers = [];
            
            document.getElementById('levelSelector').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('currentLevel').textContent = level;
            document.getElementById('totalQuestions').textContent = levelQuestions.length;
            document.getElementById('completionMessage').style.display = 'none';
            
            updatePowerupCounts();
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestion >= levelQuestions.length) {
                showCompletion();
                return;
            }

            const questionData = levelQuestions[currentQuestion];
            document.getElementById('question').textContent = questionData.question;
            document.getElementById('questionNumber').textContent = currentQuestion + 1;
            document.getElementById('score').textContent = score;
            
            const answersContainer = document.getElementById('answers');
            answersContainer.innerHTML = '';
            eliminatedAnswers = [];
            
            questionData.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer;
                button.onclick = () => selectAnswer(index, button);
                answersContainer.appendChild(button);
            });

            // Applica effetto time bonus se attivo
            if (activePowerups.timeBonus) {
                answersContainer.classList.add('time-bonus-active');
            }

            updateProgress();
        }

        function selectAnswer(selectedIndex, buttonElement) {
            const questionData = levelQuestions[currentQuestion];
            const buttons = document.querySelectorAll('.answer-btn');
            
            buttons.forEach(btn => btn.style.pointerEvents = 'none');
            
            let pointsToAdd = 10;
            
            // Applica bonus double points
            if (activePowerups.doublePoints) {
                pointsToAdd = 20;
                activePowerups.doublePoints = false;
                showPowerupNotification('Punti raddoppiati! üíé');
            }
            
            // Applica bonus time bonus (punti extra)
            if (activePowerups.timeBonus) {
                pointsToAdd += 5;
                activePowerups.timeBonus = false;
                showPowerupNotification('Bonus velocit√†! ‚ö°');
            }
            
            if (selectedIndex === questionData.correct) {
                buttonElement.classList.add('correct');
                score += pointsToAdd;
                createParticles('üéâ');
            } else {
                buttonElement.classList.add('incorrect');
                buttons[questionData.correct].classList.add('correct');
                createParticles('üíî');
            }
            
            setTimeout(() => {
                currentQuestion++;
                showQuestion();
            }, 2000);
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / levelQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showCompletion() {
            document.getElementById('completionMessage').style.display = 'block';
            document.getElementById('finalScore').textContent = score + '/' + (levelQuestions.length * 10);
            createParticles('üéä');
        }

        function backToMenu() {
            document.getElementById('levelSelector').style.display = 'grid';
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('crosswordArea').style.display = 'none';
            // Reset powerups quando si torna al menu
            activePowerups.timeBonus = false;
            activePowerups.doublePoints = false;
        }

        function startCrossword() {
            document.getElementById('levelSelector').style.display = 'none';
            document.getElementById('crosswordArea').style.display = 'block';
            initializeCrossword();
        }

        function initializeCrossword() {
            const grid = document.getElementById('crosswordGrid');
            grid.innerHTML = '';
            currentWord = null;
            completedWords.clear();
            crosswordStartTime = Date.now();
            
            // Crea la griglia
            for (let row = 0; row < 16; row++) {
                for (let col = 0; col < 16; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'crossword-cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    if (crosswordData.grid[row][col] === '') {
                        cell.classList.add('blocked');
                    } else {
                        const input = document.createElement('input');
                        input.maxLength = 1;
                        input.addEventListener('input', handleCellInput);
                        input.addEventListener('focus', handleCellFocus);
                        cell.appendChild(input);
                    }
                    
                    grid.appendChild(cell);
                }
            }
            
            // Aggiungi numeri alle celle
            crosswordData.words.forEach(word => {
                const cell = grid.children[word.row * 16 + word.col];
                if (!cell.classList.contains('blocked')) {
                    const number = document.createElement('div');
                    number.className = 'cell-number';
                    number.textContent = word.number;
                    cell.appendChild(number);
                }
            });
            
            // Crea gli indizi
            createClues();
            updateCrosswordTimer();
        }

        function createClues() {
            const horizontalClues = document.getElementById('horizontalClues');
            const verticalClues = document.getElementById('verticalClues');
            
            horizontalClues.innerHTML = '';
            verticalClues.innerHTML = '';
            
            crosswordData.words.forEach(word => {
                const clueElement = document.createElement('div');
                clueElement.className = 'clue';
                clueElement.textContent = `${word.number}. ${word.clue}`;
                clueElement.onclick = () => selectWord(word);
                
                if (word.direction === 'horizontal') {
                    horizontalClues.appendChild(clueElement);
                } else {
                    verticalClues.appendChild(clueElement);
                }
            });
        }

        function selectWord(word) {
            const grid = document.getElementById('crosswordGrid');
            
            // Rimuovi highlight precedenti
            Array.from(grid.children).forEach(cell => {
                cell.classList.remove('word-highlight', 'active');
            });
            
            // Rimuovi active dalle clues
            document.querySelectorAll('.clue').forEach(clue => {
                clue.classList.remove('active');
            });
            
            currentWord = word;
            
            // Evidenzia la parola
            for (let i = 0; i < word.word.length; i++) {
                const row = word.direction === 'horizontal' ? word.row : word.row + i;
                const col = word.direction === 'horizontal' ? word.col + i : word.col;
                const cell = grid.children[row * 16 + col];
                cell.classList.add('word-highlight');
            }
            
            // Attiva la clue
            const clues = document.querySelectorAll('.clue');
            clues[crosswordData.words.indexOf(word)].classList.add('active');
            
            // Focus sulla prima cella vuota
            const firstEmptyCell = findFirstEmptyCell(word);
            if (firstEmptyCell) {
                firstEmptyCell.querySelector('input').focus();
            }
        }

        function findFirstEmptyCell(word) {
            const grid = document.getElementById('crosswordGrid');
            for (let i = 0; i < word.word.length; i++) {
                const row = word.direction === 'horizontal' ? word.row : word.row + i;
                const col = word.direction === 'horizontal' ? word.col + i : word.col;
                const cell = grid.children[row * 16 + col];
                const input = cell.querySelector('input');
                if (!input.value) {
                    return cell;
                }
            }
            return null;
        }

        function handleCellInput(event) {
            const input = event.target;
            const cell = input.parentElement;
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            
            input.value = input.value.toUpperCase();
            
            // Controlla se le parole sono completate
            checkCompletedWords();
            
            // Muovi al prossimo input se currentWord √® selezionata
            if (currentWord && input.value) {
                moveToNextCell(row, col);
            }
        }

        function handleCellFocus(event) {
            const cell = event.target.parentElement;
            cell.classList.add('active');
            
            // Rimuovi active da altre celle
            document.querySelectorAll('.crossword-cell').forEach(c => {
                if (c !== cell) c.classList.remove('active');
            });
        }

        function moveToNextCell(currentRow, currentCol) {
            if (!currentWord) return;
            
            const grid = document.getElementById('crosswordGrid');
            const wordIndex = crosswordData.words.indexOf(currentWord);
            
            // Trova la posizione corrente nella parola
            let positionInWord = -1;
            for (let i = 0; i < currentWord.word.length; i++) {
                const row = currentWord.direction === 'horizontal' ? currentWord.row : currentWord.row + i;
                const col = currentWord.direction === 'horizontal' ? currentWord.col + i : currentWord.col;
                
                if (row === currentRow && col === currentCol) {
                    positionInWord = i;
                    break;
                }
            }
            
            // Muovi alla prossima cella
            if (positionInWord < currentWord.word.length - 1) {
                const nextRow = currentWord.direction === 'horizontal' ? currentWord.row : currentWord.row + positionInWord + 1;
                const nextCol = currentWord.direction === 'horizontal' ? currentWord.col + positionInWord + 1 : currentWord.col;
                const nextCell = grid.children[nextRow * 16 + nextCol];
                nextCell.querySelector('input').focus();
            }
        }

        function checkCompletedWords() {
            const grid = document.getElementById('crosswordGrid');
            
            crosswordData.words.forEach((word, index) => {
                let isComplete = true;
                let currentAnswer = '';
                
                for (let i = 0; i < word.word.length; i++) {
                    const row = word.direction === 'horizontal' ? word.row : word.row + i;
                    const col = word.direction === 'horizontal' ? word.col + i : word.col;
                    const cell = grid.children[row * 16 + col];
                    const input = cell.querySelector('input');
                    
                    currentAnswer += input.value;
                    if (!input.value || input.value !== word.word[i]) {
                        isComplete = false;
                    }
                }
                
                if (isComplete && !completedWords.has(index)) {
                    completedWords.add(index);
                    
                    // Marca le celle come corrette
                    for (let i = 0; i < word.word.length; i++) {
                        const row = word.direction === 'horizontal' ? word.row : word.row + i;
                        const col = word.direction === 'horizontal' ? word.col + i : word.col;
                        const cell = grid.children[row * 16 + col];
                        cell.classList.add('correct');
                    }
                    
                    // Marca la clue come completata
                    const clues = document.querySelectorAll('.clue');
                    clues[index].classList.add('completed');
                    
                    createParticles('üéâ');
                }
            });
            
            document.getElementById('crosswordProgress').textContent = completedWords.size;
            
            // Controlla se il cruciverba √® completato
            if (completedWords.size === crosswordData.words.length) {
                showCrosswordCompletion();
            }
        }

        function showCrosswordCompletion() {
            const endTime = Date.now();
            const totalTime = Math.floor((endTime - crosswordStartTime) / 1000);
            const minutes = Math.floor(totalTime / 60);
            const seconds = totalTime % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('finalTime').textContent = timeString;
            document.getElementById('crosswordComplete').style.display = 'block';
            
            createParticles('üéä');
        }

        function updateCrosswordTimer() {
            if (document.getElementById('crosswordArea').style.display !== 'block') return;
            
            const currentTime = Date.now();
            const elapsed = Math.floor((currentTime - crosswordStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('crosswordTime').textContent = timeString;
            
            setTimeout(updateCrosswordTimer, 1000);
        }

        function usePowerup(type) {
            if (powerups[type] <= 0) return;
            
            const button = document.getElementById(type);
            if (button.classList.contains('disabled') || button.classList.contains('used')) return;
            
            powerups[type]--;
            
            switch(type) {
                case 'fiftyFifty':
                    useFiftyFifty();
                    break;
                case 'skipQuestion':
                    useSkipQuestion();
                    break;
                case 'timeBonus':
                    useTimeBonus();
                    break;
                case 'doublePoints':
                    useDoublePoints();
                    break;
            }
            
            updatePowerupCounts();
        }

        function useFiftyFifty() {
            const questionData = levelQuestions[currentQuestion];
            const buttons = document.querySelectorAll('.answer-btn');
            const correctIndex = questionData.correct;
            const incorrectIndices = [];
            
            buttons.forEach((btn, index) => {
                if (index !== correctIndex && !eliminatedAnswers.includes(index)) {
                    incorrectIndices.push(index);
                }
            });
            
            // Elimina 2 risposte sbagliate casuali
            const toEliminate = incorrectIndices.sort(() => 0.5 - Math.random()).slice(0, 2);
            toEliminate.forEach(index => {
                buttons[index].classList.add('eliminated');
                buttons[index].onclick = null;
                eliminatedAnswers.push(index);
            });
            
            showPowerupNotification('2 risposte eliminate! üéØ');
        }

        function useSkipQuestion() {
            showPowerupNotification('Domanda saltata! ‚è≠Ô∏è');
            setTimeout(() => {
                currentQuestion++;
                showQuestion();
            }, 1000);
        }

        function useTimeBonus() {
            activePowerups.timeBonus = true;
            showPowerupNotification('Bonus velocit√† attivato! ‚ö°');
        }

        function useDoublePoints() {
            activePowerups.doublePoints = true;
            showPowerupNotification('Punti raddoppiati attivato! üíé');
        }

        function updatePowerupCounts() {
            document.getElementById('fiftyFiftyCount').textContent = powerups.fiftyFifty;
            document.getElementById('skipQuestionCount').textContent = powerups.skipQuestion;
            document.getElementById('timeBonusCount').textContent = powerups.timeBonus;
            document.getElementById('doublePointsCount').textContent = powerups.doublePoints;
            
            // Disabilita powerups esauriti
            Object.keys(powerups).forEach(key => {
                const button = document.getElementById(key);
                if (powerups[key] <= 0) {
                    button.classList.add('disabled');
                } else {
                    button.classList.remove('disabled');
                }
            });
        }

        function showPowerupNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'powerup-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 2000);
        }

        function createParticles(emoji) {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.textContent = emoji;
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 2000);
                }, i * 100);
            }
        }

        // Animazione di background
        function createBackgroundParticles() {
            const particles = ['ü¶†', 'üß¨', '‚öóÔ∏è', 'üî¨'];
            setInterval(() => {
                const particle = document.createElement('div');
                particle.style.position = 'fixed';
                particle.style.left = Math.random() * window.innerWidth + 'px';
                particle.style.top = '-50px';
                particle.style.fontSize = '20px';
                particle.style.opacity = '0.1';
                particle.style.pointerEvents = 'none';
                particle.style.zIndex = '-1';
                particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                particle.style.animation = 'particleFloat 10s linear forwards';
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                }, 10000);
            }, 3000);
        }

        // Inizializza animazioni di sfondo
        createBackgroundParticles();
    </script>
</body>
</html>